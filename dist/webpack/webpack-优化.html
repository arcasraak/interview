<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 优化 | 烈虎</title>
    <meta name="description" content="自信，坚持，求真">
    <link rel="icon" href="/assets/img/favicon.ico">
  <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?11ee3eaf406620d405bb85e0f32425c7";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
    <link rel="preload" href="/assets/css/0.styles.88e887d6.css" as="style"><link rel="preload" href="/assets/js/app.35f11c12.js" as="script"><link rel="preload" href="/assets/js/2.eb556243.js" as="script"><link rel="preload" href="/assets/js/18.085ef9ea.js" as="script"><link rel="prefetch" href="/assets/js/10.0c0b0eae.js"><link rel="prefetch" href="/assets/js/11.e130fd59.js"><link rel="prefetch" href="/assets/js/12.97fc811f.js"><link rel="prefetch" href="/assets/js/13.b4d7e019.js"><link rel="prefetch" href="/assets/js/14.b1ba4139.js"><link rel="prefetch" href="/assets/js/15.b7617c43.js"><link rel="prefetch" href="/assets/js/16.6a59926e.js"><link rel="prefetch" href="/assets/js/17.48522ed3.js"><link rel="prefetch" href="/assets/js/19.a6396023.js"><link rel="prefetch" href="/assets/js/20.7ca6016c.js"><link rel="prefetch" href="/assets/js/21.fe97404c.js"><link rel="prefetch" href="/assets/js/22.113532d8.js"><link rel="prefetch" href="/assets/js/23.e8397c16.js"><link rel="prefetch" href="/assets/js/24.7580cc54.js"><link rel="prefetch" href="/assets/js/25.7fa05509.js"><link rel="prefetch" href="/assets/js/26.aa0f108b.js"><link rel="prefetch" href="/assets/js/27.2a2e48d8.js"><link rel="prefetch" href="/assets/js/28.3454e55e.js"><link rel="prefetch" href="/assets/js/29.669e6ad8.js"><link rel="prefetch" href="/assets/js/3.77c1e61e.js"><link rel="prefetch" href="/assets/js/30.0e96ce52.js"><link rel="prefetch" href="/assets/js/31.9d47bafd.js"><link rel="prefetch" href="/assets/js/32.80ec44aa.js"><link rel="prefetch" href="/assets/js/33.7f1c038c.js"><link rel="prefetch" href="/assets/js/34.4959f808.js"><link rel="prefetch" href="/assets/js/35.d160d52b.js"><link rel="prefetch" href="/assets/js/36.a602653c.js"><link rel="prefetch" href="/assets/js/37.1fff559e.js"><link rel="prefetch" href="/assets/js/38.104f20c9.js"><link rel="prefetch" href="/assets/js/39.4625485d.js"><link rel="prefetch" href="/assets/js/4.1403428f.js"><link rel="prefetch" href="/assets/js/40.e751f0f4.js"><link rel="prefetch" href="/assets/js/41.c871840e.js"><link rel="prefetch" href="/assets/js/42.1819caa3.js"><link rel="prefetch" href="/assets/js/43.5ed8e1cf.js"><link rel="prefetch" href="/assets/js/44.2e7b6381.js"><link rel="prefetch" href="/assets/js/45.4a709130.js"><link rel="prefetch" href="/assets/js/46.d38ec9f1.js"><link rel="prefetch" href="/assets/js/47.9f090d7a.js"><link rel="prefetch" href="/assets/js/48.6981fff7.js"><link rel="prefetch" href="/assets/js/49.21470a38.js"><link rel="prefetch" href="/assets/js/5.e0a040f3.js"><link rel="prefetch" href="/assets/js/50.7030b9b3.js"><link rel="prefetch" href="/assets/js/51.646e6ba3.js"><link rel="prefetch" href="/assets/js/52.3e5a2c56.js"><link rel="prefetch" href="/assets/js/53.731c5d35.js"><link rel="prefetch" href="/assets/js/6.45d0b66a.js"><link rel="prefetch" href="/assets/js/7.c59a4300.js"><link rel="prefetch" href="/assets/js/8.e5f09db2.js"><link rel="prefetch" href="/assets/js/9.3aacda42.js">
    <link rel="stylesheet" href="/assets/css/0.styles.88e887d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">烈虎</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://segmentfault.com/u/peichenhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的思否
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/Guide.html" class="nav-link">日积月累</a></div><div class="nav-item"><a href="https://github.com/pch1024" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://segmentfault.com/u/peichenhu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的思否
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/Guide.html" class="nav-link">日积月累</a></div><div class="nav-item"><a href="https://github.com/pch1024" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Guide.html" class="sidebar-link">Hello World</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/webpack-优化.html" class="active sidebar-link">webpack 优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#loader-设置include或者exclude" class="sidebar-link">loader 设置include或者exclude</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#url-loader" class="sidebar-link">url-loader</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#image-webpack-loader" class="sidebar-link">image-webpack-loader</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#externals" class="sidebar-link">externals</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#moduleconcatenationplugin" class="sidebar-link">ModuleConcatenationPlugin</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#defineplugin" class="sidebar-link">DefinePlugin</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#tree-shaking" class="sidebar-link">tree shaking</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#uglifyjs-webpack-plugin" class="sidebar-link">uglifyjs-webpack-plugin</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#commonschunkplugin" class="sidebar-link">CommonsChunkPlugin</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#namedmodulesplugin" class="sidebar-link">NamedModulesPlugin</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#懒加载" class="sidebar-link">懒加载</a></li><li class="sidebar-sub-header"><a href="/webpack/webpack-优化.html#缓存处理" class="sidebar-link">缓存处理</a></li></ul></li><li><a href="/webpack/webpack-loader.html" class="sidebar-link">webpack-loader</a></li><li><a href="/webpack/webpack-plugins.html" class="sidebar-link">webpack-plugins</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码片段</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>原创文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法研究</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/个人简历.html" class="sidebar-link">个人简历</a></li><li><a href="/项目案例/项目案例.html" class="sidebar-link">项目案例</a></li><li><a href="/Optimization.html" class="sidebar-link">网站优化</a></li><li><a href="/WXAPP.html" class="sidebar-link">微信小程序</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-优化"><a href="#webpack-优化" aria-hidden="true" class="header-anchor">#</a> webpack 优化</h1> <h2 id="loader-设置include或者exclude"><a href="#loader-设置include或者exclude" aria-hidden="true" class="header-anchor">#</a> loader 设置include或者exclude</h2> <ul><li>一般第三方包都是打包好的，无需再打包，特别是babel-loader、eslint-loader</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="url-loader"><a href="#url-loader" aria-hidden="true" class="header-anchor">#</a> url-loader</h2> <ul><li>可以将一些比较小的静态文件进行encode，转成base64内联。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.(woff2?|eot|ttf|otf)(\?.*)?$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 小于10kb的会转成base64</span>
    limit<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="image-webpack-loader"><a href="#image-webpack-loader" aria-hidden="true" class="header-anchor">#</a> image-webpack-loader</h2> <ul><li>使用image-webpack-loader进行图片压缩，可以和url-loader配合使用，先压缩，然后小的转base64</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.(jpe?g|png|gif|svg)$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
  <span class="token comment">// 保证在其他loader前进行处理</span>
  enforce<span class="token punctuation">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="externals"><a href="#externals" aria-hidden="true" class="header-anchor">#</a> externals</h2> <ul><li><p>比如用到一些第三方库，可以不通过webpack打包获取，而且通过挂载在windows上、amd、commonjs等获取</p></li> <li><p>这个在做组件库时需要割掉vue的代码，做按需加载时也需要用到</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>externals<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">'Vue'</span><span class="token punctuation">:</span> <span class="token string">'window.Vue'</span><span class="token punctuation">,</span>
  <span class="token string">'Vuex'</span><span class="token punctuation">:</span> <span class="token string">'window.Vuex'</span><span class="token punctuation">,</span>
  <span class="token comment">// 或者是commonjs、amd</span>
  <span class="token string">'Vue'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    commonjs<span class="token punctuation">:</span> <span class="token string">'vue'</span><span class="token punctuation">,</span>
    amd<span class="token punctuation">:</span> <span class="token string">'vue'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'components/button'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    commonjs<span class="token punctuation">:</span> <span class="token string">'gs-ui/lib/button.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="moduleconcatenationplugin"><a href="#moduleconcatenationplugin" aria-hidden="true" class="header-anchor">#</a> ModuleConcatenationPlugin</h2> <ul><li><p>webpack 3新增的特性，用于将作用域提升，通过减少闭包的数量，能加快js的运行速度和一定程度减少体积</p></li> <li><p>会增加编译时间和破坏热更新，所以只在生成环境使用</p></li> <li><p>webpack4中引入<code>mode</code>概念，在生成环境中会自动开启</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="defineplugin"><a href="#defineplugin" aria-hidden="true" class="header-anchor">#</a> DefinePlugin</h2> <ul><li><p>DefinePlugin将用&quot;production&quot;替换到process.env.NODE_ENV：</p></li> <li><p>UglifyJS会移除掉所有if分支 – 因为&quot;production&quot; !== 'production'永远返回 false ，插件理解代码内的判断分支将永远不会执行</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'process.env.NODE_ENV'</span><span class="token punctuation">:</span> <span class="token string">'&quot;production&quot;'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="tree-shaking"><a href="#tree-shaking" aria-hidden="true" class="header-anchor">#</a> tree shaking</h2> <ul><li><p>利用es module的静态解析，移除无用依赖</p></li> <li><p>babelrc中配置<code>modules: false</code>，让babel不要处理import、export，让webpack进行处理</p></li> <li><p>webpack会在打包时标记无用代码，最后交给压缩工具进行移除</p></li> <li><p>更详细的解释可以看<a href="https://github.com/linrui1994/note/blob/master/2017-12-22__tree-shaking.md" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="uglifyjs-webpack-plugin"><a href="#uglifyjs-webpack-plugin" aria-hidden="true" class="header-anchor">#</a> uglifyjs-webpack-plugin</h2> <ul><li>支持<code>parallel</code>字段，可以进行并行化构建，可以显着加速构建</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    parallel<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="commonschunkplugin"><a href="#commonschunkplugin" aria-hidden="true" class="header-anchor">#</a> CommonsChunkPlugin</h2> <ul><li>用于提取一些公共代码，一般是用于提取第三方库，这个在上线部署时很有必要，因为出现bug，一般都是业务代码的问题，第三方库相对比较稳定，这个时候第三方库代码不应该受到影响，CommonsChunkPlugin可以减少热更的代价</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将第三方库单独打包成一个vender</span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">minChunks</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// any required modules inside node_modules are extracted to vendor</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
      <span class="token regex">/\.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../node_modules'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>但是单独抽离vender是不够的，如果业务代码发生变化，还是会导致vender的hash值发生变化，缓存的作用也随着消失，解决这个问题需要再打一个包，一般命名manifest或者runtime</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'runtime'</span><span class="token punctuation">,</span>
  <span class="token comment">// 无限大代表需要在所有的模块中共享的代码才会打包进来，意味着没有任何模块打包进来，只有webpack的运行代码</span>
  minChunks<span class="token punctuation">:</span> <span class="token number">Infinity</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>webpack4中已经移除，使用optimization.splitChunks和optimization.runtimeChunk代替</li></ul> <h2 id="namedmodulesplugin"><a href="#namedmodulesplugin" aria-hidden="true" class="header-anchor">#</a> NamedModulesPlugin</h2> <ul><li><p>NamedModulesPlugin可以让webpack打包时的chunk id变得稳定，如果我们手动添加一个依赖，会使得chunk id发生变化，这个插件做的就是让id稳定下来</p></li> <li><p>webpack4中在开发模式中自动开启（--mode development）</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="懒加载"><a href="#懒加载" aria-hidden="true" class="header-anchor">#</a> 懒加载</h2> <ul><li><p>webpack2以上支持动态import()，webpack1使用require.ensure，返回一个promise</p></li> <li><p>webpack遇到import()，会单独将其抽离成一个js文件，等到运行时才去加载</p></li> <li><p>一般用的多是在单页面中，像vue-router、react-router等都支持import()进行懒加载</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doSomeThing</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token keyword">default</span><span class="token punctuation">:</span> moment<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">+</span> <span class="token punctuation">{</span>
  <span class="token function">doSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="缓存处理"><a href="#缓存处理" aria-hidden="true" class="header-anchor">#</a> 缓存处理</h2> <ul><li><p>一般情况下是让服务器添加相关的头，比如<code>Cache-Control</code>或者<code>Expires</code></p></li> <li><p>也可以利用h5的manifest缓存，可以做离线缓存</p></li> <li><p>可以利用<code>appcache-webpack-plugin</code>，即使处于离线状态也是可以正常打开网页的，不过慢慢被淘汰，取而代之的是PWA</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">AppCachePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    network<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// No network access allowed!</span>
    output<span class="token punctuation">:</span> <span class="token string">'cache.appcache'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// output
CACHE MANIFEST
# c5a4d08e79f57e7c0b18

/static/log26736681.png
/static/index.d156bde75c3265560b9b.js
/static/vendor.1fe523904e40ca0cfc76.js
/static/manifest.5969cefb99f458a69963.js
/static/index.5202b34274a8b8bad9c76962a800f30c.css
/static/../index.html

NETWORK:
*
</code></pre></div><ul><li>把输出的cache.appcache添加到html标签上就可以了</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Guide.html" class="prev">Hello World</a></span> <span class="next"><a href="/webpack/webpack-loader.html">webpack-loader</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.35f11c12.js" defer></script><script src="/assets/js/2.eb556243.js" defer></script><script src="/assets/js/18.085ef9ea.js" defer></script>
  </body>
</html>
